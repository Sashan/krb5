mydir=clients$(S)kdestroy
BUILDTOP=$(REL)..$(S)..

##WIN32##LOCALINCLUDES=-I$(BUILDTOP)\util\windows\

SRCS=kdestroy.c \
	kwarnd_clnt.c \
	kwarnd_xdr.c \
	../kwarn/kwarnd_clnt_stubs.c \
	../kwarn/kwarnd_handle.c

RPCGEN=@RPCGEN@

kwarnd.h:	../kwarn/kwarnd.x
	$(RM) $@
	$(RPCGEN) -M -h ../kwarn/kwarnd.x > $@

kwarnd_xdr.c:	../kwarn/kwarnd.x
	$(RM) $@
	$(RPCGEN) -M -c ../kwarn/kwarnd.x > $@

kwarnd_clnt.c:	../kwarn/kwarnd.x
	$(RM) $@
	$(RPCGEN) -M -l ../kwarn/kwarnd.x > $@

kwarnd_clnt_stubs.o: ../kwarn/kwarnd_clnt_stubs.c
	$(CC) -c -o $@ ../kwarn/kwarnd_clnt_stubs.c

kwarnd_handle.o: ../kwarn/kwarnd_handle.c
	$(CC) -c -o $@ ../kwarn/kwarnd_handle.c

kwarnd_xdr.o: kwarnd.h kwarnd_xdr.c
	$(CC) -c -o $@ kwarnd_xdr.c

##WIN32##VERSIONRC = $(BUILDTOP)\windows\version.rc
##WIN32##RCFLAGS=$(CPPFLAGS) -I$(top_srcdir) -D_WIN32 -DRES_ONLY

##WIN32##KDESTROY=$(OUTPRE)kdestroy.exe

##WIN32##EXERES=$(KDESTROY:.exe=.res)

##WIN32##$(EXERES): $(VERSIONRC)
##WIN32##        $(RC) $(RCFLAGS) -DKDESTROY_APP -fo $@ -r $**

all-unix: kdestroy
##WIN32##all-windows: $(KDESTROY)

kdestroy: kwarnd.h kwarnd_handle.o kwarnd_clnt_stubs.o kwarnd_clnt.o \
	kwarnd_xdr.o kdestroy.o $(KRB5_BASE_DEPLIBS)
	$(CC_LINK) -o $@ kdestroy.o kwarnd_handle.o kwarnd_clnt_stubs.o \
	    kwarnd_xdr.o kwarnd_clnt.o $(KRB5_BASE_LIBS)

##WIN32##$(KDESTROY): $(OUTPRE)kdestroy.obj $(SLIB) $(KLIB) $(CLIB) $(EXERES)
##WIN32##	link $(EXE_LINKOPTS) -out:$@ $**
##WIN32##	$(_VC_MANIFEST_EMBED_EXE)

clean-unix::
	$(RM) kdestroy.o kdestroy kwarnd_xdr.o kwarnd_handle.o \
		kwarnd_clnt_stubs.o kwarnd_xdr.c kwarnd.h kwarnd_clnt.o \
		kwarnd_clnt.c

install-unix:
	for f in kdestroy; do \
	  $(INSTALL_PROGRAM) $$f \
		$(DESTDIR)$(CLIENT_BINDIR)/`echo $$f|sed '$(transform)'`; \
	done
